<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="keywords" content="ç å†œ">
<meta name="description" content="ä¸ªäººå¾®åš">
<meta name="theme-color" content="#000">
<title>YangjunLiu</title>
<link rel="shortcut icon" href="/favicon.ico?v=1619246575726">
<link rel="stylesheet" href="/styles/main.css">
<link rel="stylesheet" href="/media/css/pisces.css">

<link rel="stylesheet" href="/media/fonts/font-awesome.css">
<link
  href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Rosario:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext"
  rel="stylesheet" type="text/css">

<link href="/media/hljs/styles/androidstudio.css"
  rel="stylesheet">

<script src="/media/hljs/highlight.js"></script>
<script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.0/velocity.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.0/velocity.ui.min.js"></script>

<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>



</head>

<body>
  <div class="head-top-line"></div>
  <div class="header-box">
    
<div class="pisces">
  <header class="header  ">
    <div class="blog-header box-shadow-wrapper bg-color " id="header">
      <div class="nav-toggle" id="nav_toggle">
        <div class="toggle-box">
          <div class="line line-top"></div>
          <div class="line line-center"></div>
          <div class="line line-bottom"></div>
        </div>
      </div>
      <div class="site-meta">       
        <div class="site-title">
          
            <a href="/" class="brand">
              <span>YangjunLiu</span>
            </a>  
          
        </div>
        
          <p class="subtitle">åˆ©äººåˆ©å·±ï¼Œä¸ºè€Œä¸äº‰ã€‚</p>
        
      </div>
      <nav class="site-nav" id="site_nav">
        <ul id="nav_ul">
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/" target="_self">
                  <i class="fa fa-home"></i> é¦–é¡µ
                </a>
              
            </li>
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/archives/" target="_self">
                  <i class="fa fa-archive"></i> å½’æ¡£
                </a>
              
            </li>
          
            
            
              
            
            <li class="nav-item nav-item-active">
              
              
                <a href="/tags/" target="_self">
                  <i class="fa fa-tags"></i> æ ‡ç­¾
                </a>
              
            </li>
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/post/about/" target="_self">
                  <i class="fa fa-user"></i> å…³äº
                </a>
              
            </li>
          
          
            
              <li class="nav-item ">
                <a href="/friends/" target="_self">
                  
                    <i class="fa fa-address-book"></i> å‹æƒ…é“¾æ¥
                  
                </a>
              </li>
            
          
        </ul>
      </nav>
    </div>
  </header>
</div>

<script type="text/javascript"> 
 
  let showNav = true;

  let navToggle = document.querySelector('#nav_toggle'),
  siteNav = document.querySelector('#site_nav');
  
  function navClick() {
    let sideBar = document.querySelector('.sidebar');
    let navUl = document.querySelector('#nav_ul');
    navToggle.classList.toggle('nav-toggle-active');
    siteNav.classList.toggle('nav-menu-active');
    if (siteNav.classList.contains('nav-menu-active')) {
      siteNav.style = "height: " + (navUl.children.length * 42) +"px !important";
    } else {
      siteNav.style = "";
    }
  }

  navToggle.addEventListener('click',navClick);  
</script>
  </div>
  <div class="main-continer">
    
    <div
      class="section-layout  pisces">
      <div class="section-layout-wrapper">
        <div id="sidebarMeta" class="sidebar">
    
<div class="sidebar-wrapper box-shadow-wrapper bg-color">
  <div class="sidebar-item">
    <img class="site-author-image right-motion" src="/images/avatar.png"/>
    <p class="site-author-name">YangjunLiu</p>
    
    <div class="site-description right-motion">
      
      
      
        <p>å¤©ä¸‹ç†™ç†™çš†ä¸ºåˆ©æ¥ï¼Œå¤©ä¸‹æ”˜æ”˜çš†ä¸ºåˆ©å¾€ã€‚</p>
      
      
    </div>
    
  </div>
  <div class="sidebar-item side-item-stat right-motion">
    <div class="sidebar-item-box">
      <a href="/archives/">
        
        <span class="site-item-stat-count">2</span>
        <span class="site-item-stat-name">æ–‡ç« </span>
      </a>
    </div>
    <div class="sidebar-item-box">
      <a href="">
        <span class="site-item-stat-count">0</span>
        <span class="site-item-stat-name">åˆ†ç±»</span>
      </a>
    </div>
    <div class="sidebar-item-box">
      <a href="/tags/">
        <span class="site-item-stat-count">0</span>
        <span class="site-item-stat-name">æ ‡ç­¾</span>
      </a>
    </div>
  </div>
  
    
      <div class="sidebar-item" style="border-top: 1px dotted #ccc; margin-top: 10px;">
      </div>
    
  
  


</div>
</div>
<script>
  let sidebarMeta = document.querySelector('#sidebarMeta');
  let scheme = 'pisces';
  let sidebarWrapper = document.querySelector('.sidebar-wrapper');
  if (sidebarMeta && (scheme === 'pisces' || scheme === 'gemini')) {
    document.addEventListener('scroll', function(e) {
      if (document.scrollingElement.scrollTop > parseInt(sidebarMeta.style.marginTop) + 10) {
        sidebarWrapper.classList.add('home-sidebar-fixed')
      } else {
        sidebarWrapper.classList.remove('home-sidebar-fixed')
      }
    });
  }
  </script>
        <div class="section-box box-shadow-wrapper">
          <section class="section tags-section bg-color posts-expand">
            <div class="tags-box">
  <div class="tag-cloud-title">
    ç›®å‰å…±è®¡ 0 ä¸ªæ ‡ç­¾
  </div>
  <div class="tag-cloud-list" id="tags">
    
  </div>
</div>
<script>

  let fontStart = 12, fontEnd = 30, colorStart = '#666', colorEnd = '#000';
  let tags = document.querySelector('#tags').children;
  let counts = [];
  for(let i = 0; i < tags.length; i++) {
    counts.push(tags[i].rel);
  }
  let lowest = Math.min.apply(null,counts), highest = Math.max.apply(null,counts);;
  let range = highest - lowest;
  if (range === 0) {
    range = 1;
  }
  let fontIncr, colorIncr;
  fontIncr = (fontEnd - fontStart) / range;
  
  let sColorArr = toRGB(colorStart), eColorArr = toRGB(colorEnd);

  for(let i = 0; i < tags.length; i++) {
    let disCount = tags[i].rel - lowest;
    let fontSize = fontStart + disCount * fontIncr;
    let style = 'font-size: ' + fontSize + 'px;';
    let arr = [];
    for(let c = 0; c < sColorArr.length; c++) {
      if (disCount === 0) {
        disCount = 1;
      }
      let val = (sColorArr[c] - eColorArr[c]) / range * disCount;
      if (val >= 100) {
        val = eColorArr[c];
      } else if (val <= 0) {
        val = sColorArr[c];
      }
      arr[c] = Math.floor(val);
    }
    style += 'color: ' + toHex(arr);
    tags[i].style = style;
  }

  function toRGB(code) {
    if (code.length === 4) {
      code = code.replace(/(\w)(\w)(\w)/gi, "\$1\$1\$2\$2\$3\$3");
    }
    var hex = /(\w{2})(\w{2})(\w{2})/.exec(code);
    return [parseInt(hex[1], 16), parseInt(hex[2], 16), parseInt(hex[3], 16)];
  }

  function toHex(ary) {
    return "#" + ((1 << 24) + (ary[0] << 16) + (ary[1] << 8) + ary[2]).toString(16).slice(1);
  }

</script>
          </section>
        </div>
      </div>
    </div>
    <div class="footer-box">
  <footer class="footer">
    <div class="copyright">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | Â© 2019-2020 Theme By <a href="https://github.com/hsxyhao/gridea-theme-next" target="_blank">HsxyHao</a>
    </div>
    <div class="poweredby">
      <a href="https://github.com/yangjunliu" target="_blank">YangjunLiu</a>
    </div>
  </footer>
  
  
  <div class="pisces back-to-top" id="back_to_top">
    <i class="fa fa-arrow-up"></i>
    
    <span class="scrollpercent">
      <span id="back_to_top_text">0</span>%
    </span>
    
  </div>
  
  
  
</div>
<script>

  let sideBarOpen = 'sidebar-open';
  let body = document.body;
  let back2Top = document.querySelector('#back_to_top'),
  back2TopText = document.querySelector('#back_to_top_text'),
  drawerBox = document.querySelector('#drawer_box'),
  rightSideBar = document.querySelector('.sidebar'),
  viewport = document.querySelector('body');

  function scrollAnimation(currentY, targetY) {
   
    let needScrollTop = targetY - currentY
    let _currentY = currentY
    setTimeout(() => {
      const dist = Math.ceil(needScrollTop / 10)
      _currentY += dist
      window.scrollTo(_currentY, currentY)
      if (needScrollTop > 10 || needScrollTop < -10) {
        scrollAnimation(_currentY, targetY)
      } else {
        window.scrollTo(_currentY, targetY)
      }
    }, 1)
  }

  back2Top.addEventListener("click", function(e) {
    scrollAnimation(document.scrollingElement.scrollTop, 0);
    e.stopPropagation();
    return false;
  });
  
  window.addEventListener('scroll', function(e) {
    let percent = document.scrollingElement.scrollTop / (document.scrollingElement.scrollHeight - document.scrollingElement.clientHeight) * 100;
    if (percent > 1 && !back2Top.classList.contains('back-top-active')) {
      back2Top.classList.add('back-top-active');
    }
    if (percent == 0) {
      back2Top.classList.remove('back-top-active');
    }
    if (back2TopText) {
      back2TopText.textContent = Math.floor(percent);
    }
  });

  
  let hasCacu = false;
  window.onresize = function() {
    if (window.width > 991) {
      calcuHeight();
    } else {
      hasCacu = false;
    }
  }

  function calcuHeight() {
    // åŠ¨æ€è°ƒæ•´ç«™ç‚¹æ¦‚è§ˆé«˜åº¦
    if (!hasCacu && back2Top.classList.contains('pisces') || back2Top.classList.contains('gemini')) {
      let sideBar = document.querySelector('.sidebar');
      let navUl = document.querySelector('#site_nav');
      sideBar.style = 'margin-top:' + (navUl.offsetHeight + navUl.offsetTop + 15) + 'px;';
      hasCacu = true;
    }
  }
  calcuHeight();
  
  let open = false, MOTION_TIME = 300, RIGHT_MOVE_DIS = '320px';

  if (drawerBox) {
    let rightMotions = document.querySelectorAll('.right-motion');
    let right = drawerBox.classList.contains('right');

    let transitionDir = right ? "transition.slideRightIn" : "transition.slideLeftIn";

    let openProp, closeProp;
    if (right) {
      openProp = {
        paddingRight: RIGHT_MOVE_DIS 
      };
      closeProp = {
        paddingRight: '0px'
      };
    } else {
      openProp = {
        paddingLeft: RIGHT_MOVE_DIS 
      };
      closeProp = {
        paddingLeft: '0px'
      };
    }

    drawerBox.onclick = function() {
      open = !open;
      window.Velocity(rightSideBar, 'stop');
      window.Velocity(viewport, 'stop');
      window.Velocity(rightMotions, 'stop');
      if (open) {
        window.Velocity(rightSideBar, {
          width: RIGHT_MOVE_DIS
        }, {
          duration: MOTION_TIME,
          begin: function() {
            window.Velocity(rightMotions, transitionDir,{ });
          }
        })
        window.Velocity(viewport, openProp,{
          duration: MOTION_TIME
        });
      } else {
        window.Velocity(rightSideBar, {
          width: '0px'
        }, {
          duration: MOTION_TIME,
          begin: function() {
            window.Velocity(rightMotions, {
              opacity: 0
            });
          }
        })
        window.Velocity(viewport, closeProp ,{
          duration: MOTION_TIME
        });
      }
      for (let i = 0; i < drawerBox.children.length; i++) {
        drawerBox.children[i].classList.toggle('muse-line');
      }
      drawerBox.classList.toggle(sideBarOpen);
    }
  }

  // é“¾æ¥è·³è½¬
  let newWindow = 'false'
  if (newWindow === 'true') {
    let links = document.querySelectorAll('.post-body a')
    links.forEach(item => {
      if (!item.classList.contains('btn')) {
        item.setAttribute("target","_blank");
      }
    })
  }
  // ä»£ç é«˜äº®
  hljs.initHighlightingOnLoad();

</script>
  </div>
</body>
<input hidden id="copy" />
<script>
  //æ‹¿æ¥ä¸»ä¹‰(çœŸé¦™)^_^ï¼ŒClipboard å®ç°æ‘˜è‡ªæ˜é‡‘ https://juejin.im/post/5aefeb6e6fb9a07aa43c20af
  window.Clipboard = (function (window, document, navigator) {
    var textArea,
      copy;

    // åˆ¤æ–­æ˜¯ä¸æ˜¯iosç«¯
    function isOS() {
      return navigator.userAgent.match(/ipad|iphone/i);
    }
    //åˆ›å»ºæ–‡æœ¬å…ƒç´ 
    function createTextArea(text) {
      textArea = document.createElement('textArea');
      textArea.value = text;
      textArea.style.width = 0;
      textArea.style.height = 0;
      textArea.clientHeight = 0;
      textArea.clientWidth = 0;
      document.body.appendChild(textArea);
    }
    //é€‰æ‹©å†…å®¹
    function selectText() {
      var range,
        selection;

      if (isOS()) {
        range = document.createRange();
        range.selectNodeContents(textArea);
        selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);
        textArea.setSelectionRange(0, 999999);
      } else {
        textArea.select();
      }
    }

    //å¤åˆ¶åˆ°å‰ªè´´æ¿
    function copyToClipboard() {
      try {
        document.execCommand("Copy")
      } catch (err) {
        alert("å¤åˆ¶é”™è¯¯ï¼è¯·æ‰‹åŠ¨å¤åˆ¶ï¼")
      }
      document.body.removeChild(textArea);
    }

    copy = function (text) {
      createTextArea(text);
      selectText();
      copyToClipboard();
    };

    return {
      copy: copy
    };
  })(window, document, navigator);

  function copyCode(e) {
    if (e.srcElement.tagName === 'SPAN' && e.srcElement.classList.contains('copy-code')) {
      let code = e.currentTarget.querySelector('code');
      var text = code.innerText;
      if (e.srcElement.textContent === 'å¤åˆ¶æˆåŠŸ') {
        console.log('å¤åˆ¶æ“ä½œé¢‘ç‡è¿‡é«˜');
        return;
      }
      e.srcElement.textContent = 'å¤åˆ¶æˆåŠŸ';
      (function (elem) {
        setTimeout(() => {
          if (elem.textContent === 'å¤åˆ¶æˆåŠŸ') {
            elem.textContent = 'å¤åˆ¶ä»£ç '
          }
        }, 1000);
      })(e.srcElement)
      Clipboard.copy(text);
    }
  }

  let pres = document.querySelectorAll('pre');
  pres.forEach(pre => {
    let code = pre.querySelector('code');
    let copyElem = document.createElement('span');
    copyElem.classList.add('copy-code');
    copyElem.textContent = 'å¤åˆ¶ä»£ç ';
    pre.appendChild(copyElem);
    pre.onclick = copyCode
  })
</script>
<script src="/media/js/motion.js"></script>

<script src="https://cdn.jsdelivr.net/gh/cferdinandi/smooth-scroll/dist/smooth-scroll.polyfills.min.js"></script>
<script>
  var scroll = new SmoothScroll('a[href*="#"]', {
    speed: 500
  });
</script>

<!-- <div class="search-mask" id="search_mask">
  <div class="search-box">
    <div class="search-title">
      <i class="fa fa-search"></i>
      <div class="input-box">
        <input type="text" placeholder="æœç´¢">
      </div>
      <i class="fa fa-times-circle"></i>
    </div>
    <div class="result">
      
      <div class="item">
        <a class="result-title" href="https://yangjunliu.github.io/post/elasticsearch-ji-chu-cha-xun/"" data-c="
          &lt;p&gt;&lt;strong&gt;ç´¢å¼•åŸç†&lt;/strong&gt;&lt;br&gt;
&lt;img src=&#34;https://yangjunliu.github.io/post-images/1619240184230.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
&lt;strong&gt;æŸ¥è¯¢ç±»å‹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;query string: æŸ¥è¯¢çš„ä¿¡æ¯æ”¾åˆ°urlé‡Œé¢&lt;br&gt;
å¦‚ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;# ç´¢å¼•å‰ç¼€ nginx-access-*
GET /nginx-access-*/_search?q=*&amp;amp;size=2&amp;amp;from=0
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;query DSL:å°†æŸ¥è¯¢ä¿¡æ¯æ‹¼æˆjsonæ ¼å¼æ”¾åˆ°è¯·æ±‚çš„bodyé‡Œé¢&lt;br&gt;
å¦‚ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;   # ç´¢å¼•å‰ç¼€ nginx-access-*
   GET /nginx-access*/_search
   {
       &amp;quot;size&amp;quot;: 2, 
       &amp;quot;query&amp;quot;: {
           &amp;quot;match_all&amp;quot;: {}
       }
   }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;Query String&lt;/strong&gt;&lt;br&gt;
è¿™ç§æŸ¥è¯¢æœ‰å±€é™æ€§æŸ¥è¯¢æ–¹å¼æœ‰é™ï¼Œä¸å¸¸ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ–‡æ¡£åœ°å€ï¼š&lt;a href=&#34;https://www.elastic.co/guide/en/elasticsearch/reference/6.8/search-uri-request.html&#34;&gt;Search API&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;æŸ¥è¯¢æ‰€æœ‰æ•°æ®&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;# ç±»ä¼¼sql: select * from table
GET /nginx-access-*/_search?q=*
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;æ¡ä»¶æŸ¥è¯¢&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;# ç±»ä¼¼sqlï¼šselect * from table where _id = gq_xHXcB1PgNMy0OCFii
GET /nginx-access-*/_search?q=_id:gq_xHXcB1PgNMy0OCFii
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;æŒ‡å®šè¿”å›å­—æ®µ&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;#ç±»ä¼¼ sqlï¼šselect container, agent from table
GET /nginx-access-*/_search?q=*&amp;amp;_source=container,agent
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;ç»“æœæ’åº&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;# ç±»ä¼¼sqlï¼šselect * from table order field desc
GET /nginx-access-*/_search?q=*&amp;amp;sort=agent.version:desc
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;ç»“æœåˆ†é¡µ&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;# ç±»ä¼¼sqlï¼šselect * from table limit 0 10
GET /nginx-access-*/_search?q=*&amp;amp;from=0&amp;amp;size=10
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;Query DSL&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ–‡æ¡£åœ°å€ &lt;a href=&#34;https://www.elastic.co/guide/en/elasticsearch/reference/7.12/query-dsl.html&#34;&gt;Query DSL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;åˆ†è¯å™¨
&lt;ol&gt;
&lt;li&gt;åˆ†è¯è§„åˆ™ï¼šæ ¹æ®esçš„åˆ†è¯å™¨è¿›è¡Œåˆ†è¯é»˜è®¤åˆ†è¯å™¨æ˜¯standardï¼Œtextç±»å‹çš„å­—æ®µä¼šæŠŠæ¯ä¸ªå•è¯è¿›è¡Œåˆ†å¼€ï¼Œå¦‚ï¼ši am nameä¼šæ‹†åˆ†æˆiï¼Œamï¼Œnameä¸‰ä¸ªè¯å­˜åœ¨ç´¢å¼•åŒºã€‚ä¸­æ–‡æ˜¯æŠŠæ¯ä¸ªå­—è¿›è¡Œæ‰åˆ†ï¼Œå¦‚ï¼šæˆ‘æ˜¯å¼ ä¸‰ä¼šæ‹†åˆ†æˆ æˆ‘ï¼Œæ˜¯ï¼Œå¼ ï¼Œä¸‰æŠŠæ¯ä¸ªå­—å­˜åœ¨ç´¢å¼•åŒºã€‚&lt;/li&gt;
&lt;li&gt;ä¼šè¿›è¡Œåˆ†è¯çš„æ•°æ®ç±»å‹ï¼štextã€‚æŒ‰åˆ†è¯å™¨è§„åˆ™æ‹†åˆ†åå­˜å‚¨åœ¨ç´¢å¼•åŒº&lt;/li&gt;
&lt;li&gt;ä¸ä¼šè¿›è¡Œåˆ†è¯çš„æ•°æ®ç±»å‹ï¼šé™¤textç±»å‹ä»¥å¤–çš„ç±»å‹ï¼Œå¦‚ï¼Œkeyword,integer,date ...ã€‚ä¸è¿›è¡Œæ‹†åˆ†ç›´æ¥å­˜å‚¨åœ¨ç´¢å¼•åŒºã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;æŸ¥è¯¢æ‰€æœ‰æ•°æ®&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;# ç±»ä¼¼sql: select * from table
GET /nginx-access-*/_search
{
  &amp;quot;query&amp;quot;: {
    &amp;quot;match_all&amp;quot;: {}
  }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;term å…³é”®å­—æŸ¥è¯¢&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;# å­—æ®µä¸æ˜¯textç±»å‹ï¼Œç±»ä¼¼sql select * from table where field = 1
# å­—æ®µæ˜¯textç±»å‹ï¼Œç±»ä¼¼sqlå…¨æ–‡ç´¢å¼•ã€‚æ ¹æ®åˆ†è¯å™¨åˆ†è¯åçš„è¯è¿›è¡ŒåŒ¹é…
GET /nginx-access-*/_search
{
  &amp;quot;query&amp;quot;: {
    &amp;quot;term&amp;quot;: {
      &amp;quot;agent.geotype&amp;quot;: {
        &amp;quot;value&amp;quot;: &amp;quot;shang&amp;quot;
      }
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;rangeèŒƒå›´æŸ¥è¯¢&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;# ç±»ä¼¼ sqlï¼šselect * from table where field &amp;gt; 1 and field &amp;lt; 10
# è¯´æ˜ gteï¼šå¤§äºç­‰äº,gtï¼šå¤§äº,lteï¼šå°äºç­‰äº,ltï¼šå°äº
GET /nginx-access-*/_search
{
  &amp;quot;query&amp;quot;: {
    &amp;quot;range&amp;quot;: {
      &amp;quot;log.offset&amp;quot;: {
        &amp;quot;gte&amp;quot;: 432141,
        &amp;quot;lte&amp;quot;: 432241
      }
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;prefix å‰ç¼€æŸ¥è¯¢&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;# ç±»ä¼¼sql select * from table field like &#39;abc%&#39;
# å­—æ®µæ˜¯textç±»å‹ï¼ŒåŒ¹é…åˆ†è¯åçš„è¯
GET /nginx-access-*/_search
{
  &amp;quot;query&amp;quot;: {
    &amp;quot;prefix&amp;quot;: {
      &amp;quot;source.geo.region_name&amp;quot;: {
        &amp;quot;value&amp;quot;: &amp;quot;bei&amp;quot;
      }
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;wildcardé€šé…ç¬¦æŸ¥è¯¢&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;# æ³¨ ?ï¼šå•ä¸ªå­—ç¬¦ï¼Œ*ï¼šä»»æ„å­—ç¬¦
# å­—æ®µæ˜¯textç±»å‹ï¼ŒåŒ¹é…åˆ†è¯åçš„è¯
GET /nginx-access-*/_search
{
  &amp;quot;size&amp;quot;: 2, 
  &amp;quot;query&amp;quot;: {
    &amp;quot;wildcard&amp;quot;: {
      &amp;quot;source.geo.region_name&amp;quot;: {
        &amp;quot;value&amp;quot;: &amp;quot;bei?ing&amp;quot;
      }
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;ids å¤šidæŸ¥è¯¢&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;# ç±»ä¼¼sqlï¼šselect * from table id in (1,2,3)
GET /nginx-access-*/_search
{
  &amp;quot;query&amp;quot;: {
    &amp;quot;ids&amp;quot;: {
      &amp;quot;values&amp;quot;: [&amp;quot;Pa_xHXcB1PgNMy0OFV5i&amp;quot;, &amp;quot;Uq_xHXcB1PgNMy0OFl_z&amp;quot;]
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;fuzzy æ¨¡ç³ŠæŸ¥è¯¢ï¼Œæœ€å¤§æ¨¡ç³Šé”™è¯¯æ˜¯0-2ä¸ªå­—æˆ–å­—æ¯ä¹‹é—´&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;# æ³¨ å…³é”®å­—åœ¨0-2ä¸ªä¹‹é—´ï¼Œå¿…é¡»å…¨åŒ¹é…
#            2-5ä¸ªä¹‹é—´ï¼Œ0-1ä¸ªé”™è¯¯
#            5ä»¥ä¸Šï¼Œ0-2ä¸ªé”™è¯¯
GET /nginx-access-*/_search
{
  &amp;quot;size&amp;quot;: 2, 
  &amp;quot;query&amp;quot;: {
    &amp;quot;fuzzy&amp;quot;: {
      &amp;quot;source.geo.region_name&amp;quot;: {
        &amp;quot;value&amp;quot;: &amp;quot;beijiii&amp;quot;
      }
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;bool å¤šæ¡ä»¶æŸ¥è¯¢ï¼Œå¯ä»¥æœ‰å¾ˆå¤šç§ç»„åˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;# ç±»ä¼¼sql select * from table where field != 1 and where field != 2 ...
# æ³¨ mustï¼š&amp;amp;&amp;amp;ï¼Œshouldï¼š||ï¼Œmust_notï¼šï¼
GET /nginx-access-*/_search
{
  &amp;quot;size&amp;quot;: 2, 
  &amp;quot;query&amp;quot;: {
    &amp;quot;bool&amp;quot;: {
      &amp;quot;must&amp;quot;: [
        {
          &amp;quot;term&amp;quot;: {
            &amp;quot;source.geo.region_name&amp;quot;: {
              &amp;quot;value&amp;quot;: &amp;quot;beijing&amp;quot;
            }
          }
        }
      ],
      &amp;quot;must_not&amp;quot;: [
        {
          &amp;quot;term&amp;quot;: {
            &amp;quot;source.geo.region_name&amp;quot;: {
              &amp;quot;value&amp;quot;: &amp;quot;shanghai&amp;quot;
            }
          }
        }
      ]
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;multi_match å¤šå­—æ®µæŸ¥è¯¢&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;# æ³¨ textç±»å‹å­—æ®µæœç´¢è¯å…ˆè¿›è¡Œåˆ†è¯
#    ä¸éœ€è¦åˆ†è¯çš„å­—æ®µç›´æ¥ç”¨æœç´¢è¯
#    æŸ¥æ‰¾ï¼Œæ ¹æ®å­—æ®µç±»å‹åˆ¤æ–­æ˜¯å¦åˆ†è¯
GET /nginx-access-*/_search
{
  &amp;quot;size&amp;quot;: 2, 
  &amp;quot;query&amp;quot;: {
    &amp;quot;multi_match&amp;quot;: {
      &amp;quot;query&amp;quot;: &amp;quot;beijing&amp;quot;,
      &amp;quot;fields&amp;quot;: [&amp;quot;source.geo.city_name&amp;quot;, &amp;quot;source.geo.region_name&amp;quot;]
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;Filter Query è¿‡æ»¤æŸ¥è¯¢ï¼Œç±»ä¼¼mysqlæŸ¥è¯¢ä¼˜åŒ–å™¨&lt;br&gt;
è¯´æ˜ï¼šesä¸­æŸ¥è¯¢æ“ä½œåˆ†ä¸º2ç§ï¼šæŸ¥è¯¢ï¼ˆqueryï¼‰å’Œè¿‡æ»¤ï¼ˆfilterï¼‰ã€‚æŸ¥è¯¢å³æ˜¯ä¸Šé¢çš„queryæŸ¥è¯¢ï¼ŒæŸ¥è¯¢é»˜è®¤ä¼šè®¡ç®—æ¯ä¸ªè¿”å›æ–‡æ¡£çš„å¾—åˆ†ï¼Œç„¶åæ ¹æ®å¾—åˆ†è¿›è¡Œæ’åºã€‚è€Œè¿‡æ»¤ï¼ˆfilterï¼‰åªä¼šç­›é€‰å‡ºç¬¦åˆçš„æ–‡æ¡£ï¼Œå¹¶ä¸è®¡ç®—å¾—åˆ†ï¼Œè€Œä¸”å¯ä»¥ç¼“å­˜æ–‡æ¡£ï¼Œæ‰€ä»¥è¿‡æ»¤æŸ¥è¯¢æ€§èƒ½æ›´å¿«ã€‚è¿‡æ»¤æŸ¥è¯¢é€‚åˆå¤§èŒƒå›´ç­›é€‰æ•°æ®ï¼Œè€ŒæŸ¥è¯¢åˆ™é€‚åˆç²¾å‡†åŒ¹é…æ•°æ®ã€‚ä¸€èˆ¬åº”å…ˆä½¿ç”¨è¿‡æ»¤æ“ä½œè¿‡æ»¤æ•°æ®ï¼Œç„¶ååœ¨ä½¿ç”¨æŸ¥è¯¢åŒ¹é…æ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;# ä¸è®¡ç®—æ–‡æ¡£å¾—åˆ†ï¼Œä¸è¿›è¡Œæ–‡æ¡£æ’åº
GET /nginx-access-*/_search
{
  &amp;quot;query&amp;quot;: {
    &amp;quot;bool&amp;quot;: {
      &amp;quot;must&amp;quot;: [
        {
          &amp;quot;term&amp;quot;: {
            &amp;quot;source.geo.city_name&amp;quot;: {
              &amp;quot;value&amp;quot;: &amp;quot;beijing&amp;quot;
            }
          }
        }
      ], 
      &amp;quot;filter&amp;quot;: [
        {
          &amp;quot;range&amp;quot;: {
            &amp;quot;log.offset&amp;quot;: {
              &amp;quot;gte&amp;quot;: 432000,
              &amp;quot;lte&amp;quot;: 433000
            }
          }
        }
      ]
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;
">elasticsearch åŸºç¡€æŸ¥è¯¢</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://yangjunliu.github.io/post/filebeat-shou-ji-nginx-ri-zhi/"" data-c="
          &lt;p&gt;è½»é‡å‹æ—¥å¿—é‡‡é›†å™¨ï¼Œæ— è®ºæ‚¨æ˜¯ä»å®‰å…¨è®¾å¤‡ã€äº‘ã€å®¹å™¨ã€ä¸»æœºè¿˜æ˜¯ OT è¿›è¡Œæ•°æ®æ”¶é›†ï¼ŒFilebeat éƒ½å°†ä¸ºæ‚¨æä¾›ä¸€ç§è½»é‡å‹æ–¹æ³•ï¼Œç”¨äºè½¬å‘å’Œæ±‡æ€»æ—¥å¿—ä¸æ–‡ä»¶ï¼Œè®©ç®€å•çš„äº‹æƒ…ä¸å†ç¹æ‚ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸‹è½½åœ°å€ï¼šhttps://artifacts.elastic.co/downloads/beats/filebeat/filebeat-7.10.2-x86_64.rpm&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œå‘½ä»¤ï¼š[biubiu@VM_0_7_centos src]$ sudo rpm -ihv filebeat-7.10.2-x86_64.rpm&lt;/li&gt;
&lt;li&gt;æŸ¥çœ‹é…ç½®æ–‡ä»¶ï¼š[biubiu@VM_0_7_centos src]$ rpm -qc filebeat&lt;img src=&#34;https://yangjunliu.github.io/post-images/1610958413766.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/li&gt;
&lt;li&gt;å¼€å¯nginxæ¨¡å—ï¼š&lt;br&gt;
[biubiu@VM_0_7_centos modules.d]$ cd /etc/filebeat/modules.d/&lt;br&gt;
[biubiu@VM_0_7_centos modules.d]$ sudo filebeat modules enable nginx&lt;/li&gt;
&lt;li&gt;æŸ¥çœ‹å·²å¼€å¯çš„æ¨¡å—ï¼š&lt;br&gt;
[biubiu@VM_0_7_centos modules.d]$ sudo filebeat modules list&lt;br&gt;
&lt;img src=&#34;https://yangjunliu.github.io/post-images/1610958665990.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/li&gt;
&lt;li&gt;ä¿®æ”¹2ä¸ªé…ç½®æ–‡ä»¶&lt;br&gt;
[biubiu@VM_0_7_centos modules.d]$ sudo egrep -v &amp;quot;&lt;sup&gt; *#|&lt;/sup&gt;$&amp;quot; /etc/filebeat/modules.d/nginx.yml&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;- module: nginx
  access:
    enabled: true
    var.paths: [&amp;quot;/usr/local/nginx/logs/test.access.log&amp;quot;]
  error:
    enabled: true
    var.paths: [&amp;quot;/usr/local/nginx/logs/test.error.log&amp;quot;]
  ingress_controller:
    enabled: false
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;[biubiu@VM_0_7_centos modules.d]$ sudo egrep -v &amp;quot;&lt;sup&gt; *#|&lt;/sup&gt;$&amp;quot; /etc/filebeat/filebeat.yml&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;filebeat.config.modules:
  path: ${path.config}/modules.d/*.yml
output.elasticsearch:
  hosts: [&amp;quot;localhost:9200&amp;quot;] # es æœåŠ¡åœ°å€
  indices:
    - index: &amp;quot;nginx-access-%{[agent.version]}-%{+yyyy.MM.dd}&amp;quot;
      when.contains:
        fileset.name: &amp;quot;access&amp;quot;
    - index: &amp;quot;nginx-error-%{[agent.version]}-%{+yyyy.MM.dd}&amp;quot;
      when.contains:
        fileset.name: &amp;quot;error&amp;quot;
    - index: &amp;quot;laravel-log-%{[agent.version]}-%{+yyyy.MM.dd}&amp;quot;
      when.contains:
        tags: &amp;quot;laravel-log&amp;quot;
  username: &amp;quot;elastic&amp;quot;
  password: &amp;quot;changepasswd&amp;quot;
setup.ilm.enabled: false
setup.template.enabled: false
setup.template.name: &amp;quot;nginx&amp;quot;
setup.template.pattern: &amp;quot;nginx-*&amp;quot;
setup.template.overwrite: true
processors:
  - add_host_metadata:
      when.not.contains.tags: forwarded
  - add_cloud_metadata: ~
  - add_docker_metadata: ~
  - add_kubernetes_metadata: ~
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;7&#34;&gt;
&lt;li&gt;å¯åŠ¨filebeatï¼š&lt;br&gt;
[biubiu@VM_0_7_centos modules.d]$ sudo systemctl start filebeat&lt;br&gt;
&lt;img src=&#34;https://yangjunliu.github.io/post-images/1610960815178.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/li&gt;
&lt;/ol&gt;
">filebeatæ”¶é›†nginxæ—¥å¿—</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://yangjunliu.github.io/post/about/"" data-c="
          &lt;blockquote&gt;
&lt;p&gt;æ¬¢è¿æ¥åˆ°æˆ‘çš„å°ç«™å‘€ï¼Œå¾ˆé«˜å…´é‡è§ä½ ï¼ğŸ¤&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;å…³äºæœ¬ç«™&#34;&gt;ğŸ  å…³äºæœ¬ç«™&lt;/h2&gt;
&lt;h2 id=&#34;åšä¸»æ˜¯è°&#34;&gt;ğŸ‘¨â€ğŸ’» åšä¸»æ˜¯è°&lt;/h2&gt;
&lt;h2 id=&#34;å…´è¶£çˆ±å¥½&#34;&gt;â›¹ å…´è¶£çˆ±å¥½&lt;/h2&gt;
&lt;h2 id=&#34;è”ç³»æˆ‘å‘€&#34;&gt;ğŸ“¬ è”ç³»æˆ‘å‘€&lt;/h2&gt;
">å…³äº</a>
      </div>
      
    </div>
  </div>
</div>
<script>
  // var escape = "[{&#34;content&#34;:&#34;&lt;p&gt;&lt;strong&gt;ç´¢å¼•åŸç†&lt;/strong&gt;&lt;br&gt;\n&lt;img src=\&#34;https://yangjunliu.github.io/post-images/1619240184230.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;br&gt;\n&lt;strong&gt;æŸ¥è¯¢ç±»å‹&lt;/strong&gt;&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;query string: æŸ¥è¯¢çš„ä¿¡æ¯æ”¾åˆ°urlé‡Œé¢&lt;br&gt;\nå¦‚ï¼š&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre&gt;&lt;code&gt;# ç´¢å¼•å‰ç¼€ nginx-access-*\nGET /nginx-access-*/_search?q=*&amp;amp;size=2&amp;amp;from=0\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ul&gt;\n&lt;li&gt;query DSL:å°†æŸ¥è¯¢ä¿¡æ¯æ‹¼æˆjsonæ ¼å¼æ”¾åˆ°è¯·æ±‚çš„bodyé‡Œé¢&lt;br&gt;\nå¦‚ï¼š&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre&gt;&lt;code&gt;   # ç´¢å¼•å‰ç¼€ nginx-access-*\n   GET /nginx-access*/_search\n   {\n       &amp;quot;size&amp;quot;: 2, \n       &amp;quot;query&amp;quot;: {\n           &amp;quot;match_all&amp;quot;: {}\n       }\n   }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;Query String&lt;/strong&gt;&lt;br&gt;\nè¿™ç§æŸ¥è¯¢æœ‰å±€é™æ€§æŸ¥è¯¢æ–¹å¼æœ‰é™ï¼Œä¸å¸¸ä½¿ç”¨ã€‚&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;æ–‡æ¡£åœ°å€ï¼š&lt;a href=\&#34;https://www.elastic.co/guide/en/elasticsearch/reference/6.8/search-uri-request.html\&#34;&gt;Search API&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;æŸ¥è¯¢æ‰€æœ‰æ•°æ®&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre&gt;&lt;code&gt;# ç±»ä¼¼sql: select * from table\nGET /nginx-access-*/_search?q=*\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ul&gt;\n&lt;li&gt;æ¡ä»¶æŸ¥è¯¢&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre&gt;&lt;code&gt;# ç±»ä¼¼sqlï¼šselect * from table where _id = gq_xHXcB1PgNMy0OCFii\nGET /nginx-access-*/_search?q=_id:gq_xHXcB1PgNMy0OCFii\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ul&gt;\n&lt;li&gt;æŒ‡å®šè¿”å›å­—æ®µ&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre&gt;&lt;code&gt;#ç±»ä¼¼ sqlï¼šselect container, agent from table\nGET /nginx-access-*/_search?q=*&amp;amp;_source=container,agent\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ul&gt;\n&lt;li&gt;ç»“æœæ’åº&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre&gt;&lt;code&gt;# ç±»ä¼¼sqlï¼šselect * from table order field desc\nGET /nginx-access-*/_search?q=*&amp;amp;sort=agent.version:desc\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ul&gt;\n&lt;li&gt;ç»“æœåˆ†é¡µ&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre&gt;&lt;code&gt;# ç±»ä¼¼sqlï¼šselect * from table limit 0 10\nGET /nginx-access-*/_search?q=*&amp;amp;from=0&amp;amp;size=10\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;Query DSL&lt;/strong&gt;&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;æ–‡æ¡£åœ°å€ &lt;a href=\&#34;https://www.elastic.co/guide/en/elasticsearch/reference/7.12/query-dsl.html\&#34;&gt;Query DSL&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;åˆ†è¯å™¨\n&lt;ol&gt;\n&lt;li&gt;åˆ†è¯è§„åˆ™ï¼šæ ¹æ®esçš„åˆ†è¯å™¨è¿›è¡Œåˆ†è¯é»˜è®¤åˆ†è¯å™¨æ˜¯standardï¼Œtextç±»å‹çš„å­—æ®µä¼šæŠŠæ¯ä¸ªå•è¯è¿›è¡Œåˆ†å¼€ï¼Œå¦‚ï¼ši am nameä¼šæ‹†åˆ†æˆiï¼Œamï¼Œnameä¸‰ä¸ªè¯å­˜åœ¨ç´¢å¼•åŒºã€‚ä¸­æ–‡æ˜¯æŠŠæ¯ä¸ªå­—è¿›è¡Œæ‰åˆ†ï¼Œå¦‚ï¼šæˆ‘æ˜¯å¼ ä¸‰ä¼šæ‹†åˆ†æˆ æˆ‘ï¼Œæ˜¯ï¼Œå¼ ï¼Œä¸‰æŠŠæ¯ä¸ªå­—å­˜åœ¨ç´¢å¼•åŒºã€‚&lt;/li&gt;\n&lt;li&gt;ä¼šè¿›è¡Œåˆ†è¯çš„æ•°æ®ç±»å‹ï¼štextã€‚æŒ‰åˆ†è¯å™¨è§„åˆ™æ‹†åˆ†åå­˜å‚¨åœ¨ç´¢å¼•åŒº&lt;/li&gt;\n&lt;li&gt;ä¸ä¼šè¿›è¡Œåˆ†è¯çš„æ•°æ®ç±»å‹ï¼šé™¤textç±»å‹ä»¥å¤–çš„ç±»å‹ï¼Œå¦‚ï¼Œkeyword,integer,date ...ã€‚ä¸è¿›è¡Œæ‹†åˆ†ç›´æ¥å­˜å‚¨åœ¨ç´¢å¼•åŒºã€‚&lt;/li&gt;\n&lt;/ol&gt;\n&lt;/li&gt;\n&lt;li&gt;æŸ¥è¯¢æ‰€æœ‰æ•°æ®&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre&gt;&lt;code&gt;# ç±»ä¼¼sql: select * from table\nGET /nginx-access-*/_search\n{\n  &amp;quot;query&amp;quot;: {\n    &amp;quot;match_all&amp;quot;: {}\n  }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ul&gt;\n&lt;li&gt;term å…³é”®å­—æŸ¥è¯¢&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre&gt;&lt;code&gt;# å­—æ®µä¸æ˜¯textç±»å‹ï¼Œç±»ä¼¼sql select * from table where field = 1\n# å­—æ®µæ˜¯textç±»å‹ï¼Œç±»ä¼¼sqlå…¨æ–‡ç´¢å¼•ã€‚æ ¹æ®åˆ†è¯å™¨åˆ†è¯åçš„è¯è¿›è¡ŒåŒ¹é…\nGET /nginx-access-*/_search\n{\n  &amp;quot;query&amp;quot;: {\n    &amp;quot;term&amp;quot;: {\n      &amp;quot;agent.geotype&amp;quot;: {\n        &amp;quot;value&amp;quot;: &amp;quot;shang&amp;quot;\n      }\n    }\n  }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ul&gt;\n&lt;li&gt;rangeèŒƒå›´æŸ¥è¯¢&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre&gt;&lt;code&gt;# ç±»ä¼¼ sqlï¼šselect * from table where field &amp;gt; 1 and field &amp;lt; 10\n# è¯´æ˜ gteï¼šå¤§äºç­‰äº,gtï¼šå¤§äº,lteï¼šå°äºç­‰äº,ltï¼šå°äº\nGET /nginx-access-*/_search\n{\n  &amp;quot;query&amp;quot;: {\n    &amp;quot;range&amp;quot;: {\n      &amp;quot;log.offset&amp;quot;: {\n        &amp;quot;gte&amp;quot;: 432141,\n        &amp;quot;lte&amp;quot;: 432241\n      }\n    }\n  }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ul&gt;\n&lt;li&gt;prefix å‰ç¼€æŸ¥è¯¢&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre&gt;&lt;code&gt;# ç±»ä¼¼sql select * from table field like &#39;abc%&#39;\n# å­—æ®µæ˜¯textç±»å‹ï¼ŒåŒ¹é…åˆ†è¯åçš„è¯\nGET /nginx-access-*/_search\n{\n  &amp;quot;query&amp;quot;: {\n    &amp;quot;prefix&amp;quot;: {\n      &amp;quot;source.geo.region_name&amp;quot;: {\n        &amp;quot;value&amp;quot;: &amp;quot;bei&amp;quot;\n      }\n    }\n  }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ul&gt;\n&lt;li&gt;wildcardé€šé…ç¬¦æŸ¥è¯¢&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre&gt;&lt;code&gt;# æ³¨ ?ï¼šå•ä¸ªå­—ç¬¦ï¼Œ*ï¼šä»»æ„å­—ç¬¦\n# å­—æ®µæ˜¯textç±»å‹ï¼ŒåŒ¹é…åˆ†è¯åçš„è¯\nGET /nginx-access-*/_search\n{\n  &amp;quot;size&amp;quot;: 2, \n  &amp;quot;query&amp;quot;: {\n    &amp;quot;wildcard&amp;quot;: {\n      &amp;quot;source.geo.region_name&amp;quot;: {\n        &amp;quot;value&amp;quot;: &amp;quot;bei?ing&amp;quot;\n      }\n    }\n  }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ul&gt;\n&lt;li&gt;ids å¤šidæŸ¥è¯¢&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre&gt;&lt;code&gt;# ç±»ä¼¼sqlï¼šselect * from table id in (1,2,3)\nGET /nginx-access-*/_search\n{\n  &amp;quot;query&amp;quot;: {\n    &amp;quot;ids&amp;quot;: {\n      &amp;quot;values&amp;quot;: [&amp;quot;Pa_xHXcB1PgNMy0OFV5i&amp;quot;, &amp;quot;Uq_xHXcB1PgNMy0OFl_z&amp;quot;]\n    }\n  }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ul&gt;\n&lt;li&gt;fuzzy æ¨¡ç³ŠæŸ¥è¯¢ï¼Œæœ€å¤§æ¨¡ç³Šé”™è¯¯æ˜¯0-2ä¸ªå­—æˆ–å­—æ¯ä¹‹é—´&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre&gt;&lt;code&gt;# æ³¨ å…³é”®å­—åœ¨0-2ä¸ªä¹‹é—´ï¼Œå¿…é¡»å…¨åŒ¹é…\n#            2-5ä¸ªä¹‹é—´ï¼Œ0-1ä¸ªé”™è¯¯\n#            5ä»¥ä¸Šï¼Œ0-2ä¸ªé”™è¯¯\nGET /nginx-access-*/_search\n{\n  &amp;quot;size&amp;quot;: 2, \n  &amp;quot;query&amp;quot;: {\n    &amp;quot;fuzzy&amp;quot;: {\n      &amp;quot;source.geo.region_name&amp;quot;: {\n        &amp;quot;value&amp;quot;: &amp;quot;beijiii&amp;quot;\n      }\n    }\n  }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ul&gt;\n&lt;li&gt;bool å¤šæ¡ä»¶æŸ¥è¯¢ï¼Œå¯ä»¥æœ‰å¾ˆå¤šç§ç»„åˆ&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre&gt;&lt;code&gt;# ç±»ä¼¼sql select * from table where field != 1 and where field != 2 ...\n# æ³¨ mustï¼š&amp;amp;&amp;amp;ï¼Œshouldï¼š||ï¼Œmust_notï¼šï¼\nGET /nginx-access-*/_search\n{\n  &amp;quot;size&amp;quot;: 2, \n  &amp;quot;query&amp;quot;: {\n    &amp;quot;bool&amp;quot;: {\n      &amp;quot;must&amp;quot;: [\n        {\n          &amp;quot;term&amp;quot;: {\n            &amp;quot;source.geo.region_name&amp;quot;: {\n              &amp;quot;value&amp;quot;: &amp;quot;beijing&amp;quot;\n            }\n          }\n        }\n      ],\n      &amp;quot;must_not&amp;quot;: [\n        {\n          &amp;quot;term&amp;quot;: {\n            &amp;quot;source.geo.region_name&amp;quot;: {\n              &amp;quot;value&amp;quot;: &amp;quot;shanghai&amp;quot;\n            }\n          }\n        }\n      ]\n    }\n  }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ul&gt;\n&lt;li&gt;multi_match å¤šå­—æ®µæŸ¥è¯¢&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre&gt;&lt;code&gt;# æ³¨ textç±»å‹å­—æ®µæœç´¢è¯å…ˆè¿›è¡Œåˆ†è¯\n#    ä¸éœ€è¦åˆ†è¯çš„å­—æ®µç›´æ¥ç”¨æœç´¢è¯\n#    æŸ¥æ‰¾ï¼Œæ ¹æ®å­—æ®µç±»å‹åˆ¤æ–­æ˜¯å¦åˆ†è¯\nGET /nginx-access-*/_search\n{\n  &amp;quot;size&amp;quot;: 2, \n  &amp;quot;query&amp;quot;: {\n    &amp;quot;multi_match&amp;quot;: {\n      &amp;quot;query&amp;quot;: &amp;quot;beijing&amp;quot;,\n      &amp;quot;fields&amp;quot;: [&amp;quot;source.geo.city_name&amp;quot;, &amp;quot;source.geo.region_name&amp;quot;]\n    }\n  }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ul&gt;\n&lt;li&gt;Filter Query è¿‡æ»¤æŸ¥è¯¢ï¼Œç±»ä¼¼mysqlæŸ¥è¯¢ä¼˜åŒ–å™¨&lt;br&gt;\nè¯´æ˜ï¼šesä¸­æŸ¥è¯¢æ“ä½œåˆ†ä¸º2ç§ï¼šæŸ¥è¯¢ï¼ˆqueryï¼‰å’Œè¿‡æ»¤ï¼ˆfilterï¼‰ã€‚æŸ¥è¯¢å³æ˜¯ä¸Šé¢çš„queryæŸ¥è¯¢ï¼ŒæŸ¥è¯¢é»˜è®¤ä¼šè®¡ç®—æ¯ä¸ªè¿”å›æ–‡æ¡£çš„å¾—åˆ†ï¼Œç„¶åæ ¹æ®å¾—åˆ†è¿›è¡Œæ’åºã€‚è€Œè¿‡æ»¤ï¼ˆfilterï¼‰åªä¼šç­›é€‰å‡ºç¬¦åˆçš„æ–‡æ¡£ï¼Œå¹¶ä¸è®¡ç®—å¾—åˆ†ï¼Œè€Œä¸”å¯ä»¥ç¼“å­˜æ–‡æ¡£ï¼Œæ‰€ä»¥è¿‡æ»¤æŸ¥è¯¢æ€§èƒ½æ›´å¿«ã€‚è¿‡æ»¤æŸ¥è¯¢é€‚åˆå¤§èŒƒå›´ç­›é€‰æ•°æ®ï¼Œè€ŒæŸ¥è¯¢åˆ™é€‚åˆç²¾å‡†åŒ¹é…æ•°æ®ã€‚ä¸€èˆ¬åº”å…ˆä½¿ç”¨è¿‡æ»¤æ“ä½œè¿‡æ»¤æ•°æ®ï¼Œç„¶ååœ¨ä½¿ç”¨æŸ¥è¯¢åŒ¹é…æ•°æ®ã€‚&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre&gt;&lt;code&gt;# ä¸è®¡ç®—æ–‡æ¡£å¾—åˆ†ï¼Œä¸è¿›è¡Œæ–‡æ¡£æ’åº\nGET /nginx-access-*/_search\n{\n  &amp;quot;query&amp;quot;: {\n    &amp;quot;bool&amp;quot;: {\n      &amp;quot;must&amp;quot;: [\n        {\n          &amp;quot;term&amp;quot;: {\n            &amp;quot;source.geo.city_name&amp;quot;: {\n              &amp;quot;value&amp;quot;: &amp;quot;beijing&amp;quot;\n            }\n          }\n        }\n      ], \n      &amp;quot;filter&amp;quot;: [\n        {\n          &amp;quot;range&amp;quot;: {\n            &amp;quot;log.offset&amp;quot;: {\n              &amp;quot;gte&amp;quot;: 432000,\n              &amp;quot;lte&amp;quot;: 433000\n            }\n          }\n        }\n      ]\n    }\n  }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&#34;,&#34;fileName&#34;:&#34;elasticsearch-ji-chu-cha-xun&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;elasticsearch åŸºç¡€æŸ¥è¯¢&#34;,&#34;tags&#34;:[],&#34;date&#34;:&#34;2021-04-24 10:26:58&#34;,&#34;dateFormat&#34;:&#34;2021-04-24&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://yangjunliu.github.io/post/elasticsearch-ji-chu-cha-xun/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;6 min read&#34;,&#34;time&#34;:308000,&#34;words&#34;:1116,&#34;minutes&#34;:6},&#34;description&#34;:&#34;ç´¢å¼•åŸç†\n\næŸ¥è¯¢ç±»å‹\n\nquery string: æŸ¥è¯¢çš„ä¿¡æ¯æ”¾åˆ°urlé‡Œé¢\nå¦‚ï¼š\n\n# ç´¢å¼•å‰ç¼€ nginx-access-*\nGET /nginx-access-*/_search?q=*&amp;amp;size=2&amp;amp;from=0\n\n...&#34;,&#34;toc&#34;:&#34;&#34;},{&#34;content&#34;:&#34;&lt;p&gt;è½»é‡å‹æ—¥å¿—é‡‡é›†å™¨ï¼Œæ— è®ºæ‚¨æ˜¯ä»å®‰å…¨è®¾å¤‡ã€äº‘ã€å®¹å™¨ã€ä¸»æœºè¿˜æ˜¯ OT è¿›è¡Œæ•°æ®æ”¶é›†ï¼ŒFilebeat éƒ½å°†ä¸ºæ‚¨æä¾›ä¸€ç§è½»é‡å‹æ–¹æ³•ï¼Œç”¨äºè½¬å‘å’Œæ±‡æ€»æ—¥å¿—ä¸æ–‡ä»¶ï¼Œè®©ç®€å•çš„äº‹æƒ…ä¸å†ç¹æ‚ã€‚&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;ä¸‹è½½åœ°å€ï¼šhttps://artifacts.elastic.co/downloads/beats/filebeat/filebeat-7.10.2-x86_64.rpm&lt;/li&gt;\n&lt;li&gt;æ‰§è¡Œå‘½ä»¤ï¼š[biubiu@VM_0_7_centos src]$ sudo rpm -ihv filebeat-7.10.2-x86_64.rpm&lt;/li&gt;\n&lt;li&gt;æŸ¥çœ‹é…ç½®æ–‡ä»¶ï¼š[biubiu@VM_0_7_centos src]$ rpm -qc filebeat&lt;img src=\&#34;https://yangjunliu.github.io/post-images/1610958413766.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/li&gt;\n&lt;li&gt;å¼€å¯nginxæ¨¡å—ï¼š&lt;br&gt;\n[biubiu@VM_0_7_centos modules.d]$ cd /etc/filebeat/modules.d/&lt;br&gt;\n[biubiu@VM_0_7_centos modules.d]$ sudo filebeat modules enable nginx&lt;/li&gt;\n&lt;li&gt;æŸ¥çœ‹å·²å¼€å¯çš„æ¨¡å—ï¼š&lt;br&gt;\n[biubiu@VM_0_7_centos modules.d]$ sudo filebeat modules list&lt;br&gt;\n&lt;img src=\&#34;https://yangjunliu.github.io/post-images/1610958665990.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/li&gt;\n&lt;li&gt;ä¿®æ”¹2ä¸ªé…ç½®æ–‡ä»¶&lt;br&gt;\n[biubiu@VM_0_7_centos modules.d]$ sudo egrep -v &amp;quot;&lt;sup&gt; *#|&lt;/sup&gt;$&amp;quot; /etc/filebeat/modules.d/nginx.yml&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code&gt;- module: nginx\n  access:\n    enabled: true\n    var.paths: [&amp;quot;/usr/local/nginx/logs/test.access.log&amp;quot;]\n  error:\n    enabled: true\n    var.paths: [&amp;quot;/usr/local/nginx/logs/test.error.log&amp;quot;]\n  ingress_controller:\n    enabled: false\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;[biubiu@VM_0_7_centos modules.d]$ sudo egrep -v &amp;quot;&lt;sup&gt; *#|&lt;/sup&gt;$&amp;quot; /etc/filebeat/filebeat.yml&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;filebeat.config.modules:\n  path: ${path.config}/modules.d/*.yml\noutput.elasticsearch:\n  hosts: [&amp;quot;localhost:9200&amp;quot;] # es æœåŠ¡åœ°å€\n  indices:\n    - index: &amp;quot;nginx-access-%{[agent.version]}-%{+yyyy.MM.dd}&amp;quot;\n      when.contains:\n        fileset.name: &amp;quot;access&amp;quot;\n    - index: &amp;quot;nginx-error-%{[agent.version]}-%{+yyyy.MM.dd}&amp;quot;\n      when.contains:\n        fileset.name: &amp;quot;error&amp;quot;\n    - index: &amp;quot;laravel-log-%{[agent.version]}-%{+yyyy.MM.dd}&amp;quot;\n      when.contains:\n        tags: &amp;quot;laravel-log&amp;quot;\n  username: &amp;quot;elastic&amp;quot;\n  password: &amp;quot;changepasswd&amp;quot;\nsetup.ilm.enabled: false\nsetup.template.enabled: false\nsetup.template.name: &amp;quot;nginx&amp;quot;\nsetup.template.pattern: &amp;quot;nginx-*&amp;quot;\nsetup.template.overwrite: true\nprocessors:\n  - add_host_metadata:\n      when.not.contains.tags: forwarded\n  - add_cloud_metadata: ~\n  - add_docker_metadata: ~\n  - add_kubernetes_metadata: ~\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ol start=\&#34;7\&#34;&gt;\n&lt;li&gt;å¯åŠ¨filebeatï¼š&lt;br&gt;\n[biubiu@VM_0_7_centos modules.d]$ sudo systemctl start filebeat&lt;br&gt;\n&lt;img src=\&#34;https://yangjunliu.github.io/post-images/1610960815178.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/li&gt;\n&lt;/ol&gt;\n&#34;,&#34;fileName&#34;:&#34;filebeat-shou-ji-nginx-ri-zhi&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;filebeatæ”¶é›†nginxæ—¥å¿—&#34;,&#34;tags&#34;:[],&#34;date&#34;:&#34;2021-01-18 14:16:08&#34;,&#34;dateFormat&#34;:&#34;2021-01-18&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://yangjunliu.github.io/post/filebeat-shou-ji-nginx-ri-zhi/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;2 min read&#34;,&#34;time&#34;:111000,&#34;words&#34;:346,&#34;minutes&#34;:2},&#34;description&#34;:&#34;è½»é‡å‹æ—¥å¿—é‡‡é›†å™¨ï¼Œæ— è®ºæ‚¨æ˜¯ä»å®‰å…¨è®¾å¤‡ã€äº‘ã€å®¹å™¨ã€ä¸»æœºè¿˜æ˜¯ OT è¿›è¡Œæ•°æ®æ”¶é›†ï¼ŒFilebeat éƒ½å°†ä¸ºæ‚¨æä¾›ä¸€ç§è½»é‡å‹æ–¹æ³•ï¼Œç”¨äºè½¬å‘å’Œæ±‡æ€»æ—¥å¿—ä¸æ–‡ä»¶ï¼Œè®©ç®€å•çš„äº‹æƒ…ä¸å†ç¹æ‚ã€‚\n\nä¸‹è½½åœ°å€ï¼šhttps://artifacts.elastic.c...&#34;,&#34;toc&#34;:&#34;&#34;},{&#34;content&#34;:&#34;&lt;blockquote&gt;\n&lt;p&gt;æ¬¢è¿æ¥åˆ°æˆ‘çš„å°ç«™å‘€ï¼Œå¾ˆé«˜å…´é‡è§ä½ ï¼ğŸ¤&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;å…³äºæœ¬ç«™\&#34;&gt;ğŸ  å…³äºæœ¬ç«™&lt;/h2&gt;\n&lt;h2 id=\&#34;åšä¸»æ˜¯è°\&#34;&gt;ğŸ‘¨â€ğŸ’» åšä¸»æ˜¯è°&lt;/h2&gt;\n&lt;h2 id=\&#34;å…´è¶£çˆ±å¥½\&#34;&gt;â›¹ å…´è¶£çˆ±å¥½&lt;/h2&gt;\n&lt;h2 id=\&#34;è”ç³»æˆ‘å‘€\&#34;&gt;ğŸ“¬ è”ç³»æˆ‘å‘€&lt;/h2&gt;\n&#34;,&#34;fileName&#34;:&#34;about&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;å…³äº&#34;,&#34;tags&#34;:[],&#34;date&#34;:&#34;2019-01-25 19:09:48&#34;,&#34;dateFormat&#34;:&#34;2019-01-25&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://yangjunliu.github.io/post/about/&#34;,&#34;hideInList&#34;:true,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;1 min read&#34;,&#34;time&#34;:6000,&#34;words&#34;:31,&#34;minutes&#34;:1},&#34;description&#34;:&#34;\næ¬¢è¿æ¥åˆ°æˆ‘çš„å°ç«™å‘€ï¼Œå¾ˆé«˜å…´é‡è§ä½ ï¼ğŸ¤\n\nğŸ  å…³äºæœ¬ç«™\nğŸ‘¨â€ğŸ’» åšä¸»æ˜¯è°\nâ›¹ å…´è¶£çˆ±å¥½\nğŸ“¬ è”ç³»æˆ‘å‘€\n...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%85%B3%E4%BA%8E%E6%9C%AC%E7%AB%99\&#34;&gt;ğŸ  å…³äºæœ¬ç«™&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%8D%9A%E4%B8%BB%E6%98%AF%E8%B0%81\&#34;&gt;ğŸ‘¨â€ğŸ’» åšä¸»æ˜¯è°&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%85%B4%E8%B6%A3%E7%88%B1%E5%A5%BD\&#34;&gt;â›¹ å…´è¶£çˆ±å¥½&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%81%94%E7%B3%BB%E6%88%91%E5%91%80\&#34;&gt;ğŸ“¬ è”ç³»æˆ‘å‘€&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;}]";
  // var json = escape.substr(1, escape.length - 2);
  // var datas = json.split(',');
  // for (let i=0; i < datas.length; i++) {
  //   let item = datas[i];
  //   let attrs = item.split('34;:&#34')
  //   debugger
  //   console.log(datas[i])
  // }
  let escapeMap = new Map();
  escapeMap.set('&#34;', '"');
  escapeMap.set('&gt;', '>');
  escapeMap.set('&#39;', "'");
  escapeMap.set('&lt;', '<');
  escapeMap.set('&quot;', '"');
  escapeMap.set('&amp;', '&');
</script> -->



</html>